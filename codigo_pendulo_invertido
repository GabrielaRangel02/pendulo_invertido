#include <Servo.h>

Servo servo;

const int trigPin = 11;
const int echoPin = 12;
const int servoPin = 9;

float deadMin = 8.0;
float deadMax = 9.0;

float distMin = 3.0;  
float distMax = 17.0; 

int servoDown = 30;     // ángulo mínimo
int servoCenter = 85;   // deadzone
int servoUp = 130;      // ángulo máximo

float suavizado = 0.15;

float pos = servoCenter;

void setup() {
  Serial.begin(9600);

  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);

  servo.attach(servoPin);
  servo.write(pos);
  delay(300);
}

float getDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long duration = pulseIn(echoPin, HIGH);
  return duration * 0.034 / 2.0;
}

void loop() {

  float dist = getDistance();
  float targetAngle;

  if (dist <= distMin) {
    targetAngle = servoDown;
  }
  else if (dist > distMin && dist < deadMin) {
    targetAngle = map(dist, distMin, deadMin, servoDown, servoCenter);
  }
  else if (dist >= deadMin && dist <= deadMax) {
    targetAngle = servoCenter;
  }
  else {  
    targetAngle = map(dist, deadMax, distMax, servoCenter, servoUp);
  }

  targetAngle = constrain(targetAngle, servoDown, servoUp);
  pos = pos + (targetAngle - pos) * suavizado;
  servo.write(pos);
  Serial.print("Distancia: ");
  Serial.print(dist);
  Serial.print(" cm | Angulo: ");
  Serial.println(pos);

  delay(15);
}
